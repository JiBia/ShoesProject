@model IEnumerable<ShoesProject.Models.CartItem>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <!-- BSTORE-BREADCRUMB START -->
            <div class="bstore-breadcrumb">
                <a href="index.html">HOMe</a>
                <span><i class="fa fa-caret-right	"></i></span>
                <span>Your shopping cart</span>
            </div>
            <!-- BSTORE-BREADCRUMB END -->
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <!-- SHOPPING-CART SUMMARY START -->
            <h2 class="page-title">Shopping-cart summary <span class="shop-pro-item">Your shopping cart contains: @{
                if (Model != null && Model.Count() > 0)
                {
                   @Model.Count();
                }
                } products</span></h2>
                <!-- SHOPPING-CART SUMMARY END -->
            </div>
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <!-- SHOPING-CART-MENU START -->
            <div class="shoping-cart-menu">
                <ul class="step">
                    <li class="step-current first">
                        <span>01. Summary</span>
                    </li>
                    <li class="step-todo second">
                        <span>02. Sign in</span>
                    </li>
                    <li class="step-todo third">
                        <span>03. Address</span>
                    </li>
                    <li class="step-todo four">
                        <span>04. Shipping</span>
                    </li>
                    <li class="step-todo last" id="step_end">
                        <span>05. Payment</span>
                    </li>
                </ul>
            </div>
            <!-- SHOPING-CART-MENU END -->
            <!-- CART TABLE_BLOCK START -->
            <div class="table-responsive">
                <!-- TABLE START -->
                <table class="table table-bordered" id="cart-summary">
                    <!-- TABLE HEADER START -->
                    <thead>
                        <tr>
                            <th class="cart-product">Product</th>
                            <th class="cart-description">Description</th>
                            <th class="cart-avail text-center">Availability</th>
                            <th class="cart-unit text-right">Unit price</th>
                            <th class="cart_quantity text-center">Qty</th>
                            <th class="cart-delete">&nbsp;</th>
                            <th class="cart-total text-right">Total</th>
                        </tr>
                    </thead>
                    <!-- TABLE HEADER END -->
                    <!-- TABLE BODY START -->
                    <tbody id="list_cart">
                        <!-- SINGLE CART_ITEM START -->
                        @{
                            if (Model != null && Model.Count() > 0)
                            {
                                foreach (var item in Model)
                                {
                                    <tr>
                                        <td class="cart-product">
                                            <a href="#"><img alt="Blouse" src="~/Content/img/@item.Product.ProductImages"></a>
                                        </td>
                                        <td class="cart-description">
                                            <p class="product-name"><a href="#">@item.Product.ProductName</a></p>
                                            <small>SKU : demo_1</small>
                                            <small><a href="#">Size :@item.Product.Sizes, Color : @item.Product.Colors</a></small>
                                        </td>
                                        <td class="cart-avail"><span class="label label-success">In stock</span></td>
                                        <td class="cart-unit">
                                            <ul class="price text-right">
                                                <li class="price">@item.Product.ProductPrice</li>
                                            </ul>
                                        </td>
                                        <td class="cart_quantity text-center">
                                                <input data-id="@item.Product.ProductId" class="cart-plus-minus Quantity" type="number" name="Quantity" id="Quantity" value="@item.Quantity" min="1">
                                        </td>
                                        <td class="cart-delete text-center">
                                            <span>
                                                <a href="#" data-id="@item.Product.ProductId" class="cart_quantity_delete" title="Delete"><i class="fa fa-trash-o"></i></a>
                                            </span>
                                        </td>
                                        <td class="cart-total">
                                            @{var money = item.Product.ProductPrice * item.Quantity;}
                                            <span class="money">@money</span>
                                        </td>
                                    </tr>
                                    }
                            }
                            else
                            {
                                <tr><td colspan="7" class="text-center text-danger">Gio hang trong!</td></tr>
                            }
                        }
                    </tbody>
                    <!-- TABLE BODY END -->
                    <!-- TABLE FOOTER START -->
                   @{
                       if (Model != null && Model.Count() > 0)
                       {
                        <tfoot>
                            @*@{ var totalSum = 0;
                                foreach (var item in Model)
                                {
                                    var totalPrice = (item.Quantity * item.Product.ProductPrice);
                                    totalSum += totalPrice;
                                }
                                var total = totalSum / Model.Count();
                             }*@
                            <tr class="cart-total-price">
                                <td class="cart_voucher" colspan="3" rowspan="4"></td>
                                <td class="text-right" colspan="3">Total products (tax excl.)</td>
                                <td id="total_product" class="price totalPrice" colspan="1"></td>
                            </tr>
                            @*<tr>
                                <td class="text-right" colspan="3">Total shipping</td>
                                <td id="total_shipping" class="price" colspan="1">$5.00</td>
                            </tr>*@
                            @foreach (var item in Model)
                            {
                                if (item.Product.ProductDiscount != null)
                                {
                                    <tr>
                                        <td class="text-right" colspan="3">Total vouchers (tax excl.)</td>
                                        <td class="price" colspan="1">$0.00</td>
                                    </tr>
                                }
                            }
                            <tr>
                                <td class="total-price-container text-right" colspan="3">
                                    <span>Total</span>
                                </td>
                                <td id="total-price-container" class="price" colspan="1">
                                    <span id="total-price" class="totalPrice"></span>
                                </td>
                            </tr>
                        </tfoot>
                       }
                }
                    <!-- TABLE FOOTER END -->
                </table>
                <!-- TABLE END -->
            </div>
            <!-- CART TABLE_BLOCK END -->
        </div>
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <!-- RETURNE-CONTINUE-SHOP START -->
            <div class="returne-continue-shop">
                <a href="@Url.Action("Index","Home")" class="continueshoping"><i class="fa fa-chevron-left"></i>Continue shopping</a>
                @{if (Model != null && Model.Count() > 0)
                    {<a href="@Url.Action("CartSignin","MyCart")" class="procedtocheckout">Proceed to checkout<i class="fa fa-chevron-right"></i></a> } }
            </div>
            <!-- RETURNE-CONTINUE-SHOP END -->
        </div>
    </div>
</div>
@section scripts{
    <script>
        $(document).ready(function () {
            $(".Quantity").click(function () {
                var tr = $(this).parents("tr");
                var price = parseInt(tr.find(".price").text());
                var money = parseInt(tr.find(".price").text());
                var quantity = parseInt($(this).val());
                var id = $(this).data("id");
                if (parseInt($(this).val()) > 0) {
                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("UpdateCart", "MyCart")",
                        data: {id:id,quantity:quantity},
                        success: function(rps){
                            tr.find(".money").text(price * quantity);
                            tr.fin(".totalPrice").text();
                        }
                    })
                }
            })
        })
        $(".cart_quantity_delete").click(function(){
            var tr = $(this).parents("tr");
            var id = $(this).data("id");
            $.ajax({
                type:"POST",
                url: "@Url.Action("DeleteCart", "MyCart")", 
                data:{id:id},
                success: function () {
                    tr.remove();
                    if ($("#list_cart > tr").length <= 0) {
                        $("#list_cart").html('<tr><td colspan="7" class="text-center text-danger">Gio hang trong!</td></tr>')
                    }
                }
            })
        })
        $(function sumcart() {
            var tr = $("#total_product").parents("tr");
            $.ajax({
                type:"GET",
                url: "@Url.Action("SumPriceCart", "MyCart")", 
            success: function (rps) {
                tr.find(".totalPrice").text(rps)
            }
        })
        })
        $(function () {
            sumcart();
        })
    </script>
}
